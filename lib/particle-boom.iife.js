var ParticleBoom=function(){"use strict";var t=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,i){for(var a=0;a<i.length;a++){var n=i[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,a,n){return a&&t(i.prototype,a),n&&t(i,n),i}}(),a=function(t){var i=t||null;if("string"==typeof t&&(i=document.querySelector(t)),i)return t;throw new Error("请传入canvas元素或选择器!")},n=function(){function n(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(t(this,n),!n.hasBoom[e]){n.hasBoom[e]=!1,this.canvas=a(i),this.w=this.canvas.width,this.h=this.canvas.height,this.ctx=this.canvas.getContext("2d");var h=Math.min(this.w,this.h),o=parseInt(h/100),s=4*o,u=6*o;this.options=Object.assign({speed:60,gap:s,radius:o,minVx:-u,maxVx:u,minVy:-u,maxVy:u,edgeOpacity:!1,onBoomEnd:function(){console.log("爆炸结束了")},filterFunc:function(t){var i=t.r,a=t.g,n=t.b;return 0!==t.a&&!(255===i&&255===a&&255===n)}},r),this.key=e,this.init()}}return i(n,[{key:"init",value:function(){var t=this.initRandomVx(this.options),i=this.initRandomVy(this.options);n.hasBoom[this.key]=!0;var a=this.initParticle(t,i,this.options);this.intervalFunc(this.canvas,this.ctx,a,this.options)}},{key:"initRandomVy",value:function(t){for(var i=[],a=t.minVy;a<=t.maxVy;a++)i.push(a);return i}},{key:"initRandomVx",value:function(t){for(var i=[],a=t.minVx;a<=t.maxVx;a++)i.push(a);return i}},{key:"initParticle",value:function(t,i,a){for(var n=[],r=a.radius,e=a.gap,h=this.ctx,o=this.w,s=this.h,u=h.getImageData(0,0,o,s).data,l=0;l<s;l+=e)for(var c=0;c<o;c+=e){var d=4*(o*l+c),v=u[d],g=u[d+1],f=u[d+2],y=u[d+3]/255;this.options.filterFunc({r:v,g:g,b:f,a:y})&&n.push({translateX:r/2,translateY:r/2,x:c,y:l,g:2.5+Math.random(),vx:t[Math.floor(Math.random()*t.length)],vy:i[Math.floor(Math.random()*i.length)],color:"rgba("+v+","+g+","+f+","+y+")"})}return n}},{key:"intervalFunc",value:function(t,i,a,n){var r=this;this.interval=setInterval((function(){r.drawParticle(t,i,a,n),r.updateBalls(t,a,n)}),n.speed)}},{key:"drawParticle",value:function(t,i,a,r){var e=0;i.clearRect(0,0,t.width,t.height);for(var h=0;h<a.length;h++)i.translate(a[h].translateX,a[h].color.translateY),i.fillStyle=a[h].color,i.beginPath(),i.arc(a[h].x,a[h].y,r.radius,0,2*Math.PI),i.closePath(),i.fill(),i.translate(-a[h].translateX,-a[h].color.translateY),(a[h].x<0-r.radius||a[h].x>t.width+r.radius||a[h].y>t.height+r.radius||a[h].y<0-r.radius)&&e++;e===a.length&&(clearInterval(this.interval),n.hasBoom[this.key]=!1,this.options.onBoomEnd())}},{key:"updateBalls",value:function(t,i,a){for(var n=0;n<i.length;n++)if(!(i[n].x<-a.radius||i[n].x>t.width+a.radius||i[n].y<-a.radius||i[n].y>t.height+a.radius)&&(i[n].x+=i[n].vx,i[n].y+=i[n].vy,i[n].vy+=i[n].g,a.edgeOpacity)){var r=/(rgba\(\d+,\d+,\d+,)(-?(\d+\.)?\d+)/g.exec(i[n].color),e=r[1],h=r[2];if(parseInt(r[2]<.1))continue;h=i[n].x+a.radius<=t.width/2&&i[n].y+a.radius<=t.height/2?i[n].x/t.width*2*(i[n].y/t.height*2):i[n].x+a.radius>=t.width/2&&i[n].y+a.radius<=t.height/2?(t.width-i[n].x)/t.width*2*(i[n].y/t.height*2):i[n].x+a.radius<=t.width/2&&i[n].y+a.radius>=t.height/2?i[n].x/t.width*2*((t.height-i[n].y)/t.height*2):(t.width-i[n].x)/t.width*2*((t.height-i[n].y)/t.height*2),h*=1.2+Math.random(),i[n].color=""+e+h+")"}}}]),n}();return n.hasBoom={},n.drawPic=function(t,i){var n=a(t),r=n.getContext("2d"),e=new Image;return e.src=i,new Promise((function(t,i){try{e.onload=function(){n.width=e.width,n.height=e.height,r.drawImage(e,0,0),t(n)}}catch(t){i(t)}}))},n}();
